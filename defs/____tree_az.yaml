- name: Azure
  id: cloud-azure
  icon: azure.png
  subitems: []
  raw: {}
  details: az__prerequisites.yaml
  query: az group list
  path-id: $[::].id
  path-name: $[::].name
  path-raw: $[::]
  operations:
    - type: create
      name: Create Resource Group
      template: az_group_create
    - type: create
      name: Create Virtual Machine
      template: az_vm_create
    - type: create
      name: Create Container Registry
      template: az_acr_create
  child-template:
    # this is a template for resource group level
    - type: delete
      name: Delete
      cmd: az resource delete --ids ${id}
      refresh: parent
    - type: query
      query: az resource list --resource-group ${name}
      path-id: $[::].id
      path-name: $[::].name
      path-raw: $[::]
    - type: child-template
      # this is a template for any resource in the resource group
      template:
        # delete is the same for any resouce in tre resource group
        - type: delete
          name: Delete
          cmd: az resource delete --ids ${id}
          refresh: parent
        # This is details query for VMs only
        - type: query-details
          when:
            path: "$.type"
            value: "Microsoft.Compute/virtualMachines"
          query: az vm get-instance-view --ids ${id}
          refresh: self
          extract:
            - field: state
              path: "$[0].status"
              map:
                active: started
                off: stopped


