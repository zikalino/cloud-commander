- name: Azure
  id: cloud-azure
  icon: azure.png
  subitems: []
  raw: {}
  details: az/az__prerequisites.yaml
  operations:
    - type: create
      name: Create Resource Group
      template: az_group_create
    - type: create
      name: Create Virtual Machine
      template:
        name: generic/generic_vm_create
        parameters:
          cloud_provider: cloud-az
    - type: create
      name: Create Container Registry
      template: az_acr_create
  child-template:
    # this is a template for resource group level
    - type: delete
      name: Delete
      cmd: az resource delete --ids ${id}
      refresh: parent

    - type: child-template
      # this is a template for any resource in the resource group
      template:
        # delete is the same for any resouce in tre resource group
        - type: delete
          name: Delete
          cmd: az resource delete --ids ${id}
          refresh: parent
        - type: start
          name: Start
          cmd: az vm start --ids ${id}
          refresh: self
          when:
            path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
            value: "PowerState/stopped"
        - type: stop
          name: Stop
          cmd: az vm stop --ids ${id}
          refresh: self
          when:
            path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
            value: "PowerState/running"
        - type: restart
          name: Restart
          cmd: az vm restart --ids ${id}
          refresh: self
          when:
            path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
            value: "PowerState/running"
