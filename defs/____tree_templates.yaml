items-sources:
  #
  # az
  #
  - type: cloud-azure
    cmd: az group list
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: az-group
    item-type-generic: group

  - type: az-group
    cmd: az resource list --resource-group ${name}
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: $.type
    item-type-generic: unknown
    type-map:
      - "Microsoft.Compute/virtualMachines": vm

  #
  # civo
  #
  - type: civo-instance-list
    cmd:
      - civo instances list --region fra1 --output json
      - civo instances list --region phx1 --output json
      - civo instances list --region lon1 --output json
      - civo instances list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].hostname
    path-raw: $[::]
    item-type: civo-instance
    item-type-generic: vm
  - type: civo-kubernetes-list
    cmd:
      - civo kubernetes list --region lon1 --output json
      - civo kubernetes list --region phx1 --output json
      - civo kubernetes list --region fra1 --output json
      - civo kubernetes list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-kubernetes
    item-type-generic: kubernetes
  - type: civo-loadbalancer-list
    cmd:
      - civo loadbalancer list --region lon1 --output json
      - civo loadbalancer list --region phx1 --output json
      - civo loadbalancer list --region fra1 --output json
      - civo loadbalancer list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-loadbalancer
    item-type-generic: loadbalancer
  - type: civo-firewall-list
    cmd:
      - civo firewall list --region lon1 --output json
      - civo firewall list --region phx1 --output json
      - civo firewall list --region fra1 --output json
      - civo firewall list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-firewall
    item-type-generic: firewall
  - type: civo-apikey-list
    cmd: civo apikey list --region fra1 --output json
    path-id: $[::].name
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-apikey
    item-type-generic: apikey
  - type: civo-database-list
    cmd:
      - civo database list --region lon1 --output json
      - civo database list --region phx1 --output json
      - civo database list --region fra1 --output json
      - civo database list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-database
    item-type-generic: database
  - type: civo-domain-list
    cmd:
      - civo domain list --region lon1 --output json
      - civo domain list --region phx1 --output json
      - civo domain list --region fra1 --output json
      - civo domain list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-domain
    item-type-generic: domain
  - type: civo-ip-list
    cmd:
      - civo ip list --region lon1 --output json
      - civo ip list --region phx1 --output json
      - civo ip list --region fra1 --output json
      - civo ip list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-ipaddress
    item-type-generic: ipaddress
  - type: civo-network-list
    cmd:
      - civo network list --region lon1 --output json
      - civo network list --region phx1 --output json
      - civo network list --region fra1 --output json
      - civo network list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type: civo-network
    item-type-generic: network
  - type: civo-objectstore-list
    cmd:
      - civo objectstore list --region lon1 --output json
      - civo objectstore list --region phx1 --output json
      - civo objectstore list --region fra1 --output json
      - civo objectstore list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-objectstorage
    item-type-generic: objectstorage
  - type: civo-volume-list
    cmd:
      - civo volume list --region lon1 --output json
      - civo volume list --region phx1 --output json
      - civo volume list --region fra1 --output json
      - civo volume list --region nyc1 --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: civo-sshkey
    item-type-generic: sshkey

  #
  # Digital Ocean
  #
  - type: doctl-droplet-list
    cmd: doctl compute droplet list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type-generic: vm
    item-type: doctl-droplet
  - type: doctl-volume-list
    cmd: doctl compute volume list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-disk
    item-type-generic: disk
  - type: doctl-kubernetes-list
    cmd: doctl kubernetes cluster list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-kubernetes
    item-type-generic: kubernetes
  - type: doctl-apps-list
    cmd: doctl apps list --output json
    path-id: $[::].id
    path-name: $[::].spec_name
    path-raw: $[::]
    item-type: doctl-application
    item-type-generic: application

  - type: doctl-functions-list
    cmd: doctl serverless functions list --output json
    path-id: $[::].id
    path-name: $[::].spec_name
    path-raw: $[::]
    item-type: doctl-function
    item-type-generic: function
  - type: doctl-database-list
    cmd: doctl databases list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-database
    item-type-generic: database
  - type: doctl-domain-list
    cmd: doctl compute domain list --output json
    path-id: $[::].domain
    path-name: $[::].domain
    path-raw: $[::]
    item-type: doctl-objectstorage
    item-type-generic: objectstorage
  - type: doctl-firewall-list
    cmd: doctl compute firewall list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-firewall
    item-type-generic: firewall
  - type: doctl-ip-list
    cmd: doctl compute reserved-ip list --output json
    path-id: $[::].ip
    path-name: $[::].ip
    path-raw: $[::]
    item-type: doctl-ipaddress
    item-type-generic: ipaddress
  - type: doctl-loadbalancer-list
    cmd: doctl compute load-balancer list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-loadbalancer
    item-type-generic: loadbalancer
  - type: doctl-registry-list
    cmd: doctl registry list --output json
    path-id: $[::].id
    path-name: $[::].name
    path-raw: $[::]
    item-type: doctl-containerregistry
    item-type-generic: containerregistry

  #
  # linode
  #
  - type: linode-linode-list
    cmd: linode linodes list --json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type-generic: vm
    item-type: linode-linode
  - type: linode-nodebalancer-list
    cmd: linode nodebalancers list --json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type: linode-loadbalancer
    item-type-generic: loadbalancer
  - type: linode-firewall-list
    cmd: linode firewalls list --json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type: linode-firewall
    item-type-generic: firewall
  - type: linode-ip-list
    cmd: linode networking ips-list --json
    path-id: $[::].address
    path-name: $[::].address
    path-raw: $[::]
    item-type: linode-ipaddress
    item-type-generic: ipaddress
  - type: linode-objectstorage-list
    cmd: linode object-storage clusters-list --json
    path-id: $[::].id
    path-name: $[::].domain
    path-raw: $[::]
    item-type: linode-objectstorage
    item-type-generic: objectstorage
  - type: linode-volume-list
    cmd: linode volumes list --json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type: linode-disk
    item-type-generic: disk
  - type: linode-vpc-list
    cmd: linode vpcs list --json
    path-id: $[::].id
    path-name: $[::].label
    path-raw: $[::]
    item-type: linode-vpc
    item-type-generic: vpc

  #
  # UpCloud
  #
  - type: upctl-server-list
    cmd: upctl server list -o json
    path-id: $.servers[::].uuid
    path-name: $.servers[::].hostname
    path-raw: $.servers[::]
    item-type-generic: vm
    item-type: upcloud-server
  - type: upctl-storage-list
    cmd: upctl storage list -o json
    path-id: $.storages[::].uuid
    path-name: $.storages[::].title
    path-raw: $.storages[::]
    item-type: upctl-objectstorage
    item-type-generic: objectstorage
  - type: upctl-servergroup-list
    cmd: upctl servergroup list -o json
    path-id: $.server_groups[::].uuid
    path-name: $.server_groups[::].title
    path-raw: $.server_groups[::]
    item-type: upctl-servergroup
    item-type-generic: servergroup
  - type: upctl-database-list
    cmd: upctl database list -o json
    path-id: $.databases[::].uuid
    path-name: $.databases[::].title
    path-raw: $.databases[::]
    item-type: upctl-database
    item-type-generic: database
  - type: upctl-gateway-list
    cmd: upctl gateway list -o json
    path-id: $.gateways[::].uuid
    path-name: $.gateways[::].name
    path-raw: $.gateways[::]
    item-type: upctl-gateway
    item-type-generic: gateway
  - type: upctl-ip-list
    cmd: upctl ip-address list -o json
    path-id: $.ip_addresses.[::].address
    path-name: $.ip_addresses[::].address
    path-raw: $.ip_addresses[::]
    item-type: upctl-ipaddress
    item-type-generic: ipaddress
  - type: upctl-kubernetes-list
    cmd: upctl kubernetes list -o json
    path-id: $.[::].uuid
    path-name: $.[::].name
    path-raw: $.[::]
    item-type: upctl-kubernetes
    item-type-generic: kubernetes
  - type: upctl-host-list
    cmd: upctl host list -o json
    path-id: $.hosts[::].id
    path-name: $.hosts[::].description
    path-raw: $.hosts[::]
    item-type: upctl-host
    item-type-generic: host
  - type: upctl-loadbalancer-list
    cmd: upctl loadbalancer list -o json
    path-id: $.loadbalancers[::].uuid
    path-name: $.loadbalancers[::].name
    path-raw: $.loadbalancers[::]
    item-type: upctl-loadbalancer
    item-type-generic: loadbalancer
  - type: upctl-network-list
    cmd: upctl network list -o json
    path-id: $.networks[::].uuid
    path-name: $.networks[::].name
    path-raw: $.networks[::]
    item-type: upctl-network
    item-type-generic: network
  - type: upctl-peering-list
    cmd: upctl networkpeering list -o json
    path-id: $.networks[::].uuid
    path-name: $.networks[::].name
    path-raw: $.networks[::]
    item-type: upctl-peering
    item-type-generic: peering
  - type: upctl-objectstorage-list
    cmd: upctl object-storage list -o json
    path-id: $.object_storages[::].uuid
    path-name: $.object_storages[::].name
    path-raw: $.object_storages[::]
    item-type: upctl-objectstorage
    item-type-generic: objectstorage
  - type: upctl-router-list
    cmd: upctl router list -o json
    path-id: $.routers[::].uuid
    path-name: $.routers[::].name
    path-raw: $.routers[::]
    item-type: upctl-router
    item-type-generic: router


details-sources:
  - type: query-details
    when:
      path: "$.type"
      value: "Microsoft.Compute/virtualMachines"
      compare: ne
    cmd: az resource show --ids ${id}
    refresh: self
  # This is details query for VMs only
  - type: query-details
    when:
      path: "$.type"
      value: "Microsoft.Compute/virtualMachines"
    cmd: az vm get-instance-view --ids ${id}
    refresh: self
  # This is details query for any other resources
  - type: query-details
    when:
      path: "$.type"
      value: "Microsoft.Compute/virtualMachines"
      compare: ne
    cmd: az resource show --ids ${id}
    refresh: self

  - type: civo-instance
    cmd: civo instances show ${id} --region ${location} -o json
    refresh: self
  - type: civo-kubernetes
    cmd: civo kubernetes show ${id} --region fra1 --output json
    refresh: self
  - type: doctl-droplet
    cmd: doctl compute droplet get ${id} -o json
    refresh: self
  - type: linode-linode
    cmd: linode linodes view ${id} --json
    refresh: self
  - type: upctl-server
    cmd: upctl server show ${id} -o json
    refresh: self


extractors:

  - type: "Microsoft.Compute/virtualMachines"
    fields:
      state:
        path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
        map:
          "PowerState/running": started
          "PowerState/stopped": stopped
      size:
        path: "$.hardwareProfile.vmSize"
      size_disk:
        path: "$.storageProfile.osDisk.diskSizeGb"
      location:
        path: "$.location"

  - type: civo-instance
    fields:
      location:
        path: "$.region"
      state:
        path: "$.status"
        map:
          ACTIVE: started
          off: stopped
      size:
        path: "$.size"
      size_cores:
        path: "$.cpu_cores"
      size_memory:
        path: "$.ram_mb"
      size_disk:
        path: "$.disk_gb"
      price:
        path: "$.price_monthly"
      image:
        path: "$.diskimage_id"

  - type: doctl-droplet
    fields:
      state:
        path: "$[0].status"
        map:
          active: started
          off: stopped
      size:
        path: "$[0].size.slug"
      location:
        path: "$[0].region.slug"
      size_cores:
        path: "$[0].size.vcpus"
      size_memory:
        path: "$[0].size.memory"
      size_disk:
        path: "$[0].size.disk"
      price:
        path: "$[0].size.price_monthly"
      image:
        path: "$[0].image.slug"

  - type: linode-linode
    fields:
      state:
        path: "$[0].status"
        map:
          running: started
          offline: stopped
          provisioning: provisioning
      size:
        path: "$[0].type"
      location:
        path: "$[0].region"
      size_cores:
        path: "$[0].specs.vcpus"
      size_memory:
        path: "$[0].specs.memory"
      size_disk:
        path: "$[0].specs.disk"
      image:
        path: "$[0].image"

  - type: upcloud-server
    fields:
      state:
        path: "$.state"
      size:
        path: "$.plan"
      location:
        path: "$.zone"
      size_cores:
        path: "$.core_number"
      size_memory:
        path: "$.memory_amount"
      size_disk:
        path: "$[0].specs.disk"
      image:
        path: "$[0].image"


operations:
  #
  # az
  #
  - type: create
    name: Create Resource Group
    template: az_group_create
  - type: create
    name: Create Virtual Machine
    template:
      name: generic/generic_vm_create
      parameters:
        cloud_provider: cloud-az
  - type: create
    name: Create Container Registry
    template: az_acr_create
  # this is a template for resource group level
  - type: delete
    name: Delete
    cmd: az resource delete --ids ${id}
    refresh: parent

  - type: delete
    name: Delete
    cmd: az resource delete --ids ${id}
    refresh: parent
  - type: start
    name: Start
    cmd: az vm start --ids ${id}
    refresh: self
    when:
      path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
      value: "PowerState/stopped"
  - type: stop
    name: Stop
    cmd: az vm stop --ids ${id}
    refresh: self
    when:
      path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
      value: "PowerState/running"
  - type: restart
    name: Restart
    cmd: az vm restart --ids ${id}
    refresh: self
    when:
      path: "$.instanceView.statuses[?(@.code < 'ProvisioningState')].code"
      value: "PowerState/running"

  #
  # civo
  #
  - type: create
    name: Create Instance
    template:
      name: generic/generic_vm_create
      parameters:
        cloud_provider: cloud-civo

  #  - type: delete
  #    name: Delete
  #    cmd: doctl compute droplet delete ${id} --force
  #    refresh: parent
  #  - type: reboot
  #    name: Reboot
  #    cmd: doctl compute droplet-action reboot ${id}
  #    when:
  #      path: "$[0].status"
  #      value: active
  #    refresh: self
  #  - type: power-off
  #    name: Power off
  #    cmd: doctl compute droplet-action power-off ${id}
  #    when:
  #      path: "$[0].status"
  #      value: active
  #    refresh: self
  #  - type: power-on
  #    name: Power on
  #    cmd: doctl compute droplet-action power-on ${id}
  #    when:
  #      path: "$[0].status"
  #      value: off
  #    refresh: self
  #  - type: other
  #    name: Enable backups
  #    cmd: doctl compute droplet-action enable-backups ${id}
  #    refresh: self
  #    #when:
  #    #  path: "$[0].status"
  #    #  value: on
  #  - type: other
  #    name: Disable backups
  #    cmd: doctl compute droplet-action disable-backups ${id}
  #    refresh: self
  #    #when:
  #    #  path: "$[0].status"
  #    #  value: off

  - type: delete
    name: Delete
    cmd: civo kubernetes delete ${name} --region fra1
    refresh: parent
  # This is copied from level below, but is exactly the same

  #
  # doctl
  # 

  - type: create
    name: Create Droplet
    template:
      name: generic/generic_vm_create
      parameters:
        cloud_provider: cloud-doctl

  - type: delete
    name: Delete
    cmd: doctl compute droplet delete ${id} --force
    refresh: parent
  - type: reboot
    name: Reboot
    cmd: doctl compute droplet-action reboot ${id}
    when:
      path: "$[0].status"
      value: active
    refresh: self
  - type: power-off
    name: Power off
    cmd: doctl compute droplet-action power-off ${id}
    when:
      path: "$[0].status"
      value: active
    refresh: self
  - type: power-on
    name: Power on
    cmd: doctl compute droplet-action power-on ${id}
    when:
      path: "$[0].status"
      value: off
    refresh: self
  - type: other
    name: Enable backups
    cmd: doctl compute droplet-action enable-backups ${id}
    refresh: self
    #when:
    #  path: "$[0].status"
    #  value: on
  - type: other
    name: Disable backups
    cmd: doctl compute droplet-action disable-backups ${id}
    refresh: self
    #when:
    #  path: "$[0].status"
    #  value: off

  - type: create
    name: Create Volume
    template: doctl_compute_volume_create
  - type: delete
    name: Delete
    cmd: doctl compute volume delete ${id} --force
    refresh: parent
  - type: other
    name: Resize
    cmd: doctl compute volume-action resize ${id}
    refresh: self
  - type: other
    name: Attach
    cmd: doctl compute volume-action attach ${id}
    refresh: self
  - type: other
    name: Detach
    cmd: doctl compute volume-action detach ${id}
    refresh: self
  - type: create
    name: Create Kubernetes Cluster
    template: doctl_kubernetes_cluster_create
  - type: delete
    name: Delete
    cmd: doctl kubernetes cluster delete ${id} --force
    refresh: parent
  - type: create
    name: Create Database
    template: doctl_databases_create
  - type: delete
    name: Delete
    cmd: doctl databases delete ${id} --force
    refresh: parent
  - type: create
    name: Create Firewall
    template: doctl_compute_firewall_create
  - type: delete
    name: Delete
    cmd: doctl compute firewall delete ${id}
    refresh: parent
  - type: create
    name: Create Container Registry
    template: doctl_registry_create
  - type: delete
    name: Delete
    cmd: doctl registry delete ${id}
    refresh: parent


  #
  # linode
  #
  - type: create
    name: Create Linode (Virtual Machine)
    template:
      name: generic/generic_vm_create
      parameters:
        cloud_provider: cloud-linode
  - type: delete
    name: Delete
    cmd: linode linodes delete ${id}
    refresh: parent
  - type: reboot
    name: Reboot
    cmd: linode linodes reboot ${id}
    when:
      path: "$[0].status"
      value: running
    refresh: self
  - type: rebuild
    name: Rebuild
    cmd: linode linodes rebuild ${id}
  - type: power-off
    name: Power off
    cmd: linode linodes shutdown ${id}
    when:
      path: "$[0].status"
      value: running
    refresh: self
  - type: power-on
    name: Power on
    cmd: linode linodes boot ${id}
    when:
      path: "$[0].status"
      value: offline
    refresh: self
  - type: other
    name: Enable backups
    cmd: linode linodes backups-enable ${id}
    when:
      path: "$[0].backups.enabled"
      value: false
    refresh: self
  - type: other
    name: Enable backups
    cmd: linode linodes backups-cancel ${id}
    when:
      path: "$[0].backups.enabled"
      value: true
    refresh: self
  - type: other
    name: Update
    cmd: linode linodes update ${id}
  - type: other
    name: Upgrade
    cmd: linode linodes upgrade ${id}
  - type: other
    name: Snapshot
    cmd: linode linodes snapshot ${id}
  - type: other
    name: Resize
    cmd: linode linodes resize ${id}
  - type: other
    name: Rescue
    cmd: linode linodes rescue ${id}
  - type: other
    name: Clone
    cmd: linode linodes clone ${id}
  - type: create
    name: Create Node Balancer
    template: linode_nodebalancers_create
  - type: delete
    name: Delete
    cmd: linode nodebalancers delete ${id}
    refresh: parent
  - type: create
    name: Create Firewall
    template: linode_firewalls_create
  - type: delete
    name: Delete
    cmd: linode firewalls delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: linode volumes delete ${id}
    refresh: parent


  #
  # upctl
  #

  - type: create
    name: Create Server
    template:
      name: generic/generic_vm_create
      parameters:
        cloud_provider: cloud-upctl
  - type: delete
    name: Delete
    cmd: upctl server delete ${id}
    refresh: parent
    when:
      path: state
      value: stopped
  - type: start
    name: Start
    cmd: upctl server start ${id}
    refresh: self
    when:
      path: state
      value: stopped
  - type: stop
    name: Stop
    cmd: upctl server stop ${id} --wait
    refresh: self
    when:
      path: state
      value: started
  - type: restart
    name: Restart
    cmd: upctl server restart ${id}
    refresh: self
    when:
      path: state
      value: started
  - type: create
    name: Create Storage
    template: upctl_storage_create
  - type: delete
    name: Delete
    cmd: upctl storage delete ${id}
    refresh: parent
  - type: create
    name: Create Server Group
    template: upctl_servergroup_create
  - type: delete
    name: Delete
    cmd: upctl servergroup delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl database delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl gateway delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl ip-address remove ${id}
    refresh: parent
  - type: create
    name: Create Kubernetes Cluster
    template: upctl_kubernetes_create
  - type: delete
    name: Delete
    cmd: upctl kubernetes delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl host delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl loadbalancer delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl network delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl networkpeering delete ${id}
    refresh: parent
  - type: delete
    name: Delete
    cmd: upctl object-storage delete ${id}
    refresh: parent
  - type: create
    name: Create Router
    template: upctl_router_create
  - type: delete
    name: Delete
    cmd: upctl router delete ${id}
    refresh: parent
